<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content=""/>
    <meta name="author" content="Mosaddek"/>
    <meta name="keyword" content="FlatLab, Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina"/>

    <title>贴子列表</title>

    <link th:href="@{/img/favicon.html}" rel="shortcut icon"/>
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/css/bootstrap-reset.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/assets/font-awesome/css/font-awesome.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/assets/jquery-easy-pie-chart/jquery.easy-pie-chart.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/css/owl.carousel.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/css/style.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/css/style-responsive.css}" rel="stylesheet" type="text/css"/>
<style>
    td,th  {
        text-align: center;
        vertical-align: middle;
    }
</style>
</head>

<body>

<div class="row">
    <div class="col-lg-12">
        <section class="panel">
            <header class="panel-heading">
                讨论帖列表
            </header>
            <table class="table table-striped table-advance table-hover">
                <thead>
                <tr>
                    <th hidden="hidden"><i class="icon-check"></i> id</th>
                    <th><i class="icon-picture"></i> 图标</th>
                    <th><i class="icon-bullhorn"></i> 标题</th>
                    <th><i class="icon-user"></i> 作者</th>
                    <th><i class="icon-group"></i> 讨论组</th>
                    <th><i class="icon-calendar"></i> 创建时间</th>
                    <th><i class="icon-edit"></i> 操作</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="dto:${postUserGroupDtos}">
                    <td hidden="hidden" th:text="${dto.posts.postId}">id</td>
                    <td><img th:src="${#httpServletRequest.getScheme()+'://'+#httpServletRequest.getServerName()+':'+#httpServletRequest.getServerPort()}+'/'+${dto.posts.postPic}" style="width:30px;height: 30px; "/></td>
                    <td th:text="${dto.posts.postTitle}">postTitle</td>
                    <td th:text="${dto.userInfo.userName}">userName</td>
                    <td th:text="${dto.groups.groupName}">groupName</td>
                    <td th:text="${dto.posts.postCreateTime}">postCreateTime</td>
                    <td>
                        <button class="btn btn-primary btn-xs" th:onclick="'showPost('+${dto.posts.postId}+')'"><i class="icon-file-text-alt "></i></button>
                        <button class="btn btn-danger btn-xs" th:onclick="'deletePost('+${dto.posts.postId}+','+'\''+${dto.posts.postTitle}+'\''+')'"><i class="icon-trash "></i></button>
                    </td>
                </tr>
                </tbody>
            </table>
        </section>
    </div>
</div>

<!--查看讨论帖模态框-->
<div class="modal fade" id="showSinglePost" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">查看讨论帖</h4>
            </div>
            <div class="modal-body">
                    <div class="panel-heading">
                        <h4 id="postTitle" name="postTitle" style="display: inline;"></h4>&nbsp;&nbsp;<small id="userName" name="userName"></small>
                    </div>
                    <div class="panel-body">
                        <div class="form">
                            <form action="#" class="form-horizontal">
                                <div class="form-group">
                                    <div class="col-sm-12" id="postContent" name="postContent"></div>
                                </div>
                            </form>
                        </div>
                    </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">返回</button>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript" th:src="@{/js/jquery-1.8.3.min.js}"></script>
<script type="text/javascript" th:src="@{/js/jquery.js}"></script>
<script type="text/javascript" th:src="@{/js/bootstrap.min.js}"></script>
<script type="text/javascript" th:src="@{/js/jquery.scrollTo.min.js}"></script>
<script type="text/javascript" th:src="@{/js/jquery.nicescroll.js}"></script>
<script type="text/javascript" th:src="@{/js/jquery.sparkline.js}"></script>
<script type="text/javascript" th:src="@{/assets/jquery-easy-pie-chart/jquery.easy-pie-chart.js}"></script>
<script type="text/javascript" th:src="@{/js/owl.carousel.js}"></script>
<script type="text/javascript" th:src="@{/js/jquery.customSelect.min.js}"></script>
<script type="text/javascript" th:src="@{/js/sparkline-chart.js}"></script>
<script type="text/javascript" th:src="@{/js/easy-pie-chart.js}"></script>
<script type="text/javascript" th:src="@{/js/common-scripts.js}"></script>
<script type="text/javascript" th:src="@{/layer/layer.js}"></script>

</body>

<script type="text/javascript">
    function showPost(id) {
        $("#showSinglePost").modal("show");
        $.ajax({
            url: "/posts/showPost",
            type: "get",
            data: {
                postId: id
            },
            success: function (data) {
                $('#postTitle').text(data.extend.post.postTitle);
                $('#userName').text(data.extend.userInfo.userName);
                $('#postContent').text(data.extend.post.postContent);
            }
        })
    }

    function deletePost(id,title) {
        layer.confirm("确认删除【" + title + "】吗？", {icon: 3, title: '提示'}, function (cindex) {
            $.ajax({
                cache:true,
                type:"POST",
                url:"/posts/deletePost",
                data:{
                    postId:id
                },
                async:true,
                success:function(result){
                    if(result.code==1){
                        layer.msg(result.msg, {time:1000, icon:1, shift:0}, function () {
                            location.reload();
                        });
                    }else{
                        layer.msg(result.msg, {time:1000, icon:1, shift:0}, function () {
                            location.reload();
                        });
                    }
                }
            });
        }, function (cindex) {
            layer.close(cindex);
        });
    }
</script>

</html>
